(()=>{"use strict";function e(e,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=e;const l=e.map((e=>new Date(e).getTime()));let u=null,a=e=>e.toISOString();"auto"===o&&(o=function(e,o){const[n,r]=t(e);let l="hour";r-n>864e5*o&&(l="day");r-n>2592e6*o&&(l="month");r-n>7776e6*o&&(l="quarter");r-n>31536e6*o&&(l="year");return l}(l,n)),"year"===o&&(a=e=>e.getFullYear().toString()),"quarter"===o&&(a=e=>`${e.getFullYear().toString()}-Q${Math.floor(e.getMonth()/3)+1}`),"month"===o&&(a=e=>`${e.getFullYear().toString()}-${e.toLocaleString("default",{month:"short"})}`),"day"===o&&(a=e=>`${e.getFullYear().toString()}-${e.toLocaleString("default",{month:"short"})}-${e.getDate().toString()}`),"hour"===o&&(a=e=>`${e.getFullYear().toString()}-${e.toLocaleString("default",{month:"short"})}-${e.getDate().toString()} ${e.getHours()}:00`),"month_cycle"===o&&(a=e=>new Intl.DateTimeFormat("default",{month:"long"}).format(e),u=[new Date("2000-01-01").getTime(),new Date("2001-01-01").getTime()]),"weekday_cycle"===o&&(a=e=>new Intl.DateTimeFormat("default",{weekday:"long"}).format(e),u=[new Date("2023-11-06").getTime(),new Date("2023-11-13").getTime()]),"hour_cycle"===o&&(a=e=>new Intl.DateTimeFormat("default",{hour:"numeric",hour12:!1}).format(e),u=[new Date("2000-01-01").getTime(),new Date("2000-01-02").getTime()]),r=l.map((e=>a(new Date(e)))),null==u&&(u=t(l));const s=function(e,t,o){const n={},[r,l]=e;let u=0;"year"===t&&(u=314496e5);"quarter"===t&&(u=72576e5);["month","month_cycle"].includes(t)&&(u=24192e5);["day","weekday_cycle"].includes(t)&&(u=864e5);["hour","hour_cycle"].includes(t)&&(u=36e5);if(u>0)for(let a=r;a<=l;a+=u){const e=o(new Date(a));void 0===n[e]&&(n[e]=a)}return n}(u,o,a);return[r,s]}function t(e){let t=e[0],o=e[0];return e.forEach((e=>{e<t&&(t=e),e>o&&(o=e)})),[t,o]}function o(e){return e.split(" ").filter((e=>/\p{L}/giu.test(e)))}function n(e,t){if(".COUNT"===t)return Array(e.body.rows.length).fill("1");const o=e.head.cells.findIndex((e=>e===t));if(o<0)throw new Error(`column ${e.id}.${t} not found`);return e.body.rows.map((e=>e.cells[o]))}function r(e){let t;try{t=new URL(e).hostname.replace(/^www\./,"").replace(/^m\./,"")}catch(o){t=e}return t.trim()}async function l(t,o){if(0===t.body.rows.length)return{type:o.type,xKey:"",xLabel:"",yKeys:{},data:[]};const r=function(t,o){const r={},{groupBy:l,xSortable:u}=function(t,o){let r=n(t,o.group.column);if(0===r.length)throw new Error(`X column ${t.id}.${o.group.column} not found`);let l=null;void 0!==o.group.dateFormat&&([r,l]=e(r,o.group.dateFormat));if(void 0!==o.group.levels){l={};for(let e=0;e<o.group.levels.length;e++){l[o.group.levels[e]]=e}}return{groupBy:r,xSortable:l}}(t,o),a=t.body.rows.map((e=>e.id)),s=o.group.column,c=o.values.some((e=>!0===e.addZeroes));if(c&&null!=u)for(const[e,n]of Object.entries(u))r[e]={sortBy:n,rowIds:{},xKey:s,xValue:e,values:{}};for(const e of o.values){var i;const c=void 0!==e.aggregate?e.aggregate:"count",g=n(t,e.column);if(0===g.length)throw new Error(`Y column ${t.id}.${e.column} not found`);let f=null;void 0!==e.group_by&&(f=n(t,e.group_by).map((t=>`${e.column}.GROUP_BY.${t}`)));const v=null!==(i=e.addZeroes)&&void 0!==i&&i,y={};for(let t=0;t<a.length;t++){var d;const n=l[t];if(void 0!==o.group.range&&(Number(n)<o.group.range[0]||Number(n)>o.group.range[1]))continue;const i=g[t],v=null!=f?f[t]:e.column,p=null!=u?u[n]:l[t];var m;if(void 0===y[v]&&(y[v]={n:0,sum:0}),"count_pct"!==c&&"mean"!==c||(y[v].n+=1),"pct"===c&&(y[v].sum+=null!==(d=Number(i))&&void 0!==d?d:0),void 0===r[n]&&(r[n]={sortBy:p,rowIds:{},xKey:s,xValue:String(n),values:{}}),void 0===r[n].rowIds[v]&&(r[n].rowIds[v]=[]),r[n].rowIds[v].push(a[t]),void 0===r[n].values[v]&&(r[n].values[v]=0),"count"!==c&&"count_pct"!==c||(r[n].values[v]+=1),"sum"===c||"mean"===c||"pct"===c)r[n].values[v]+=null!==(m=Number(i))&&void 0!==m?m:0}Object.keys(y).forEach((e=>{for(const t of Object.keys(r)){if(void 0===r[t].values[e]){if(!v)continue;r[t].values[e]=0}"mean"===c&&(r[t].values[e]=Number(r[t].values[e])/y[e].n),"count_pct"===c&&(r[t].values[e]=100*Number(r[t].values[e])/y[e].n),"pct"===c&&(r[t].values[e]=100*Number(r[t].values[e])/y[e].sum)}}))}return r}(t,o);return function(e,t,o){const r=function(e,t){const o={};for(const r of t.values){let t="default";if("pct"!==r.aggregate&&"count_pct"!==r.aggregate||(t="percent"),void 0===r.group_by){const e=void 0!==r.label?r.label:r.column;o[r.column]={id:r.column,label:e,tickerFormat:t}}else{const l=Array.from(new Set(n(e,r.group_by)));for(const e of l){const n=`${r.column}.GROUP_BY.${e}`;o[n]={id:n,label:e,tickerFormat:t}}}}return{type:t.type,xKey:t.group.column,xLabel:t.group.label,yKeys:o,data:[]}}(e,t);return r.data=Object.values(o).sort(((e,t)=>e.sortBy<t.sortBy?-1:t.sortBy<e.sortBy?1:0)).map((e=>{for(const t of Object.keys(e.values))e.values[t]=Math.round(100*e.values[t])/100;return{...e.values,[e.xKey]:e.xValue,__rowIds:e.rowIds,__sortBy:e.sortBy}})),r}(t,o,r)}async function u(e,t){const l={type:t.type,topTerms:[]};if(0===e.body.rows.length)return l;const u=n(e,t.textColumn),a=function(e,t,n){const l={};for(let a=0;a<e.length;a++){if(null==(null===e||void 0===e?void 0:e[a]))continue;const s=e[a],c=null!=n.tokenize&&n.tokenize?o(s):[s],i=new Set;for(let e of c){var u;"url_domain"===n.extract&&(e=r(e)),void 0===l[e]&&(l[e]={value:0,docFreq:0}),i.has(e)||(l[e].docFreq+=1,i.add(e));const o=null!=t&&null!==(u=Number(t[a]))&&void 0!==u?u:1;isNaN(o)||(l[e].value+=o)}}return l}(u,null!=t.valueColumn?n(e,t.valueColumn):null,t);return l.topTerms=function(e,t,o){return Object.entries(e).map((e=>{let[o,n]=e;const r=n.value,l=Math.log(t/n.docFreq);return{text:o,value:n.value,importance:r*l}})).sort(((e,t)=>t.importance-e.importance)).slice(0,o)}(a,u.length,200),l}self.onmessage=e=>{(async function(e,t){if(void 0===e||void 0===t)throw new Error("Table and visualization are required");if(["line","bar","area"].includes(t.type))return await l(e,t);if(["wordcloud"].includes(t.type))return await u(e,t);throw new Error(`Visualization type ${t.type} not supported`)})(e.data.table,e.data.visualization).then((e=>{self.postMessage({status:"success",visualizationData:e})})).catch((e=>{console.error(e),self.postMessage({status:"error",visualizationData:void 0})}))}})();
//# sourceMappingURL=774.b843f8c7.chunk.js.map